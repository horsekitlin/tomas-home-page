kind: pipeline
type: docker
name: linux-amd64
platform:
  arch: amd64
  os: linux

steps:
  - name: test
    image: node
    commands:
      - yarn install
      - yarn build

  - name: scp files
    image: appleboy/drone-scp
    pull: true
    settings:
      host: 
      - 139.162.9.68
      port: 22
      username: root
      user: root
      password: 
        from_secret: ssh_password
      target: /root
      source:
        - /drone/src/build
      when:
        branch: master

  - name: ssh files
    image: appleboy/drone-scp
    pull: true
    settings:
      host: 
        - 139.162.9.68
      username: root
      user: root
      password: 
        from_secret: ssh_password
      command_timeout: 600
      script:
        - ./root/.nvm/nvm.sh && nvm use 10.9.0
        - mkdir -p /var/www/html/home.tomas.website
        - ls /root
      when:
        branch: master
